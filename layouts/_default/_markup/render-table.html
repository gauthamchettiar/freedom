{{- /*
  Render Table Hook
  
  Renders markdown tables with optional width control, caption, and alignment.
  - width: Control table width (compact/full/wide)
    - compact (default): Table width fits content
    - full: Full width of page content
    - wide: Maximum width
  - caption: Add a caption below the table
  - align: Align table and caption (left/center/right)
  
  Examples:
    | Header 1 | Header 2 |
    | -------- | -------- |
    | Cell 1   | Cell 2   |
    {width="full" caption="Table 1: Sample data" align="center"}
*/ -}}

{{- $width := .Attributes.width | default "compact" -}}
{{- $caption := .Attributes.caption | default "" -}}
{{- $align := .Attributes.align | default "" -}}

{{- /* Build table head */ -}}
{{- $thead := "" -}}
{{- range .THead -}}
  {{- $theadRow := "" -}}
  {{- range . -}}
    {{- $style := cond .Alignment (printf ` style="text-align: %s"` .Alignment) "" -}}
    {{- $theadRow = printf `%s<th%s>%s</th>` $theadRow $style .Text -}}
  {{- end -}}
  {{- $thead = printf `%s<tr>%s</tr>` $thead $theadRow -}}
{{- end -}}

{{- /* Build table body */ -}}
{{- $tbody := "" -}}
{{- range .TBody -}}
  {{- $tbodyRow := "" -}}
  {{- range . -}}
    {{- $style := cond .Alignment (printf ` style="text-align: %s"` .Alignment) "" -}}
    {{- $tbodyRow = printf `%s<td%s>%s</td>` $tbodyRow $style .Text -}}
  {{- end -}}
  {{- $tbody = printf `%s<tr>%s</tr>` $tbody $tbodyRow -}}
{{- end -}}

{{- /* Build additional attributes */ -}}
{{- $attrs := "" -}}
{{- range $k, $v := .Attributes -}}
  {{- if and $v (ne $k "width") (ne $k "caption") (ne $k "align") -}}
    {{- $attrs = printf `%s %s="%s"` $attrs $k $v -}}
  {{- end -}}
{{- end -}}

{{- /* Build table content */ -}}
{{- $captionHTML := cond $caption (printf `<figcaption>%s</figcaption>` $caption) "" -}}
{{- $tableContent := "" -}}
{{- if or $caption (ne $width "compact") -}}
  {{- $tableContent = printf `<figure class="table-figure">
<table%s>
  <thead>%s</thead>
  <tbody>%s</tbody>
</table>
%s
</figure>` $attrs $thead $tbody $captionHTML -}}
{{- else -}}
  {{- $tableContent = printf `<table%s>
  <thead>%s</thead>
  <tbody>%s</tbody>
</table>` $attrs $thead $tbody -}}
{{- end -}}

{{ partial "layouts/box.html" (dict "content" $tableContent "width" $width "align" $align) }}