{{ $header := or (.Attributes.header) "row" }}
{{ $caption := .Attributes.caption }}
{{ $captionAlign := .Attributes.captionalign | default "left" }}
{{ $captionClass := printf "caption %s" $captionAlign }}

{{ $hasRowHeader := or (eq $header "row") (eq $header "row-column") }}
{{ $hasColHeader := or (eq $header "column") (eq $header "row-column") }}

<figure>
  <table>
    {{- if $hasRowHeader }}
    <thead>
      {{- range .THead }}
      <tr>
        {{- range $i, $cell := . }}
        {{- if and $hasColHeader (eq $i 0) }}
        <th{{- with $cell.Alignment }} style="text-align: {{ . }}"{{- end }}>
          {{- $cell.Text -}}
        </th>
        {{- else }}
        <th{{- with $cell.Alignment }} style="text-align: {{ . }}"{{- end }}>
          {{- $cell.Text -}}
        </th>
        {{- end }}
        {{- end }}
      </tr>
      {{- end }}
    </thead>
    {{- end }}
    <tbody>
      {{- if not $hasRowHeader }}
      {{- range .THead }}
      <tr>
        {{- range $i, $cell := . }}
        {{- if and $hasColHeader (eq $i 0) }}
        <th scope="row"{{- with $cell.Alignment }} style="text-align: {{ . }}"{{- end }}>
          {{- $cell.Text -}}
        </th>
        {{- else }}
        <td{{- with $cell.Alignment }} style="text-align: {{ . }}"{{- end }}>
          {{- $cell.Text -}}
        </td>
        {{- end }}
        {{- end }}
      </tr>
      {{- end }}
      {{- end }}
      {{- range .TBody }}
      <tr>
        {{- range $i, $cell := . }}
        {{- if and $hasColHeader (eq $i 0) }}
        <th scope="row"{{- with $cell.Alignment }} style="text-align: {{ . }}"{{- end }}>
          {{- $cell.Text -}}
        </th>
        {{- else }}
        <td{{- with $cell.Alignment }} style="text-align: {{ . }}"{{- end }}>
          {{- $cell.Text -}}
        </td>
        {{- end }}
        {{- end }}
      </tr>
      {{- end }}
    </tbody>
  </table>
  {{- with $caption }}
  <figcaption class="{{ $captionClass }}">{{ . }}</figcaption>
  {{- end }}
</figure>
