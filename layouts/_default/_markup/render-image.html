{{- $width := .Attributes.width | default "compact" -}}
{{- $process := .Attributes.process | default "" -}}
{{- $align := .Attributes.align | default "" -}}

{{- /* Build context for image resolver */ -}}
{{- $ctx := dict "url" (.Destination | safeURL) "process" $process -}}
{{- $url := partial "utils/resolve-image.html" $ctx -}}

{{- /* Build image content - always use figure for consistent attribute support */ -}}
{{- $caption := "" -}}
{{- with .Title -}}
  {{- $caption = printf `<figcaption>%s</figcaption>` . -}}
{{- end -}}

{{- $altText := cond .PlainText (printf ` alt="%s"` .PlainText) "" -}}
{{- $imageContent := printf `<figure class="image-figure">
  <img src="%s"%s>
  %s
</figure>` $url $altText $caption -}}

{{ partial "layouts/box.html" (dict "content" $imageContent "width" $width "align" $align) }}