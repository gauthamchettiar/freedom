{{- $wide := .Attributes.wide | default false -}}
{{- $process := .Attributes.process | default "" -}}
{{- $align := .Attributes.align | default "" -}}

{{- /* Build CSS classes */ -}}
{{- $classes := slice -}}
{{- if $wide -}}
  {{- $classes = $classes | append "image-wide" -}}
{{- end -}}
{{- if $align -}}
  {{- $classes = $classes | append (printf "image-align-%s" $align) -}}
{{- end -}}
{{- $class := delimit $classes " " -}}

{{- /* Build context for image resolver */ -}}
{{- $ctx := dict "url" (.Destination | safeURL) "process" $process -}}
{{- $url := partial "utils/resolve-image.html" $ctx -}}

{{- if .IsBlock -}}
  <figure class="image-figure{{ if $class }} {{ $class }}{{ end }}">
    <img src="{{ $url }}"
      {{- with .PlainText }} alt="{{ . }}"{{ end -}}
    >
    {{- with .Title }}<figcaption>{{ . }}</figcaption>{{ end -}}
  </figure>
{{- else -}}
  <img src="{{ $url }}"{{ if $class }} class="{{ $class }}"{{ end }}
    {{- with .PlainText }} alt="{{ . }}"{{ end -}}
    {{- with .Title }} title="{{ . }}"{{ end -}}
  >
{{- end -}}