{{- /*
  Render Codeblock Hook
  
  Renders code blocks with syntax highlighting and optional display label.
  - Display label is positioned at the top right (via {display="..."} attribute)
  - Falls back to language type if display is not provided
  - Control visibility with {showLang=false} attribute (default: true)
  - Control copy button with {showCopy=false} attribute (default: true)
  - Control width with {width="compact|full|wide"} attribute (default: compact)
  
  Examples:
    ```go {display="main.go"}
    package main
    ```
    
    ```go {showLang=false}
    package main
    ```
    
    ```go {width="wide"}
    package main
    ```
*/ -}}

{{- $showLang := .Attributes.showlang | default (partial "utils/config.html" (dict "key" "showCodeblockLang" "default" true)) -}}
{{- $showCopy := .Attributes.showcopy | default (partial "utils/config.html" (dict "key" "showCodeblockCopy" "default" true)) -}}
{{- $width := .Attributes.width | default "full" -}}
{{- $align := .Attributes.align | default "" -}}

{{- $displayLabel := .Attributes.display | default .Type -}}
{{- $copyButton := "" -}}
{{- if and $showCopy $displayLabel -}}
  {{- $copyButton = printf `<button class="codeblock-copy chroma" aria-label="Copy code" title="Copy code">
    <span class="cl">%s</span>
  </button>` (partial "icon.html" (dict "name" "copy" "class" "icon-sm")) -}}
{{- end -}}

{{- $langLabel := "" -}}
{{- if and $showLang $displayLabel -}}
  {{- $langLabel = printf `<div class="codeblock-lang chroma"><span class="cl">%s</span></div>` $displayLabel -}}
{{- end -}}

{{- $codeblockContent := printf `<div class="codeblock">
  %s
  %s
  %s
</div>` $copyButton $langLabel (highlight .Inner .Type .Options) -}}

{{ partial "layouts/box.html" (dict "content" $codeblockContent "width" $width "align" $align) }}
