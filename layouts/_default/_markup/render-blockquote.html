{{- /*
  Blockquote Render Hook

  Renders blockquotes with support for GitHub-style alerts and custom attributes.
  
  Features:
    - Standard blockquotes with optional cite/caption
    - GitHub-style alerts: NOTE, TIP, IMPORTANT, WARNING, CAUTION
    - Collapsible alerts with + (open) or - (closed) prefix
    - Width/align control via attributes
  
  Attributes:
    - width: "compact", "full" (default), "wide"
    - align: "left", "center", "right"
    - cite: Citation URL
    - caption: Custom caption text
  
  Alert Syntax:
    > [!NOTE] Optional custom title
    > Alert content here
    
    > [!TIP+] Collapsible and open by default
    > [!WARNING-] Collapsible and closed by default
  
  Examples:
    > Simple blockquote
    
    > [!NOTE]
    > This is a note alert
    
    > Regular blockquote with attributes
    {width="wide" align="center"}
*/ -}}

{{- $showBlockquoteCite := partial "utils/config.html" (dict "key" "showBlockquoteCite" "default" true) -}}
{{- $showBlockquoteCaption := partial "utils/config.html" (dict "key" "showBlockquoteCaption" "default" true) -}}

{{- $width := .Attributes.width | default "full" -}}
{{- $align := .Attributes.align | default "" -}}

{{ $icons := dict
  "caution" "triangle-exclamation"
  "important" "star"
  "note" "circle-info"
  "tip" "lightbulb"
  "warning" "circle-exclamation"
}}

{{- $defaultIcon := "circle-info" -}}

{{- $blockquoteContent := "" -}}
{{- if eq .Type "alert" -}}
  {{- $isFoldable := or (strings.Contains .AlertSign "+") (strings.Contains .AlertSign "-") -}}
  {{- $isOpen := strings.Contains .AlertSign "+" -}}
  {{- $alertIcon := index $icons .AlertType | default $defaultIcon -}}
  
  {{- if $isFoldable -}}
    {{- $blockquoteContent = printf `<details class="blockquote-alert alert-%s"%s>
      <summary class="alert-heading">
        <span class="alert-heading-text">%s&nbsp;%s</span>
      </summary>
      <div class="alert-content">
        %s
      </div>
    </details>` .AlertType (cond $isOpen " open" "") (partialCached "icon.html" (dict "name" $alertIcon) "alert" $alertIcon) (cond .AlertTitle .AlertTitle (or (i18n .AlertType) (title .AlertType))) .Text -}}
  {{- else -}}
    {{- $blockquoteContent = printf `<blockquote class="blockquote-alert alert-%s">
      <p class="alert-heading">
        %s&nbsp;%s
      </p>
      <div class="alert-content">%s</div>
    </blockquote>` .AlertType (partialCached "icon.html" (dict "name" $alertIcon) "alert" $alertIcon) (cond .AlertTitle .AlertTitle (or (i18n .AlertType) (title .AlertType))) .Text -}}
  {{- end -}}
{{- else -}}
  {{- $citeLink := "" -}}
  {{- with .Attributes.cite -}}
    {{- if $showBlockquoteCite -}}
      {{- $citeLink = printf `<sup><a href="%s">[cite]</a></sup>` . -}}
    {{- end -}}
  {{- end -}}
  
  {{- $captionHTML := "" -}}
  {{- with .Attributes.caption -}}
    {{- if $showBlockquoteCaption -}}
      {{- $captionHTML = printf `<figcaption class="blockquote-caption">â€” %s</figcaption>` (. | safeHTML) -}}
    {{- end -}}
  {{- end -}}
  
  {{- $blockquoteContent = printf `<figure class="blockquote-figure">
  <blockquote%s>
    %s%s
  </blockquote>
  %s
</figure>` (cond .Attributes.cite (printf ` cite="%s"` .Attributes.cite) "") .Text $citeLink $captionHTML -}}
{{- end -}}

{{ partial "layouts/box.html" (dict "content" $blockquoteContent "width" $width "align" $align) }}