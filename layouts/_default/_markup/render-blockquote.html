{{- $showBlockquoteCite := partial "utils/config.html" (dict "key" "showBlockquoteCite" "default" true) -}}
{{- $showBlockquoteCaption := partial "utils/config.html" (dict "key" "showBlockquoteCaption" "default" true) -}}

{{- $width := .Attributes.width | default "full" -}}
{{- $align := .Attributes.align | default "" -}}

{{ $icons := dict
  "caution" "triangle-exclamation"
  "important" "star"
  "note" "circle-info"
  "tip" "lightbulb"
  "warning" "circle-exclamation"
}}

{{- $blockquoteContent := "" -}}
{{- if eq .Type "alert" -}}
  {{- $isFoldable := or (strings.Contains .AlertSign "+") (strings.Contains .AlertSign "-") -}}
  {{- $isOpen := strings.Contains .AlertSign "+" -}}
  
  {{- if $isFoldable -}}
    {{- $blockquoteContent = printf `<details class="blockquote-alert alert-%s"%s>
      <summary class="alert-heading">
        %s&nbsp;%s
      </summary>
      <div class="alert-content">
        %s
      </div>
    </details>` .AlertType (cond $isOpen " open" "") (partialCached "icon.html" (dict "name" (index $icons .AlertType)) "alert" .AlertType) (cond .AlertTitle .AlertTitle (or (i18n .AlertType) (title .AlertType))) .Text -}}
  {{- else -}}
    {{- $blockquoteContent = printf `<blockquote class="blockquote-alert alert-%s">
      <p class="alert-heading">
        %s&nbsp;%s
      </p>
      <p class="alert-content">%s</p>
    </blockquote>` .AlertType (partialCached "icon.html" (dict "name" (index $icons .AlertType)) "alert" .AlertType) (cond .AlertTitle .AlertTitle (or (i18n .AlertType) (title .AlertType))) .Text -}}
  {{- end -}}
{{- else -}}
  {{- $citeLink := "" -}}
  {{- with .Attributes.cite -}}
    {{- if $showBlockquoteCite -}}
      {{- $citeLink = printf `<sup><a href="%s">[cite]</a></sup>` . -}}
    {{- end -}}
  {{- end -}}
  
  {{- $captionHTML := "" -}}
  {{- with .Attributes.caption -}}
    {{- if $showBlockquoteCaption -}}
      {{- $captionHTML = printf `<figcaption class="blockquote-caption">â€” %s</figcaption>` (. | safeHTML) -}}
    {{- end -}}
  {{- end -}}
  
  {{- $blockquoteContent = printf `<figure class="blockquote-figure">
  <blockquote%s>
    %s%s
  </blockquote>
  %s
</figure>` (cond .Attributes.cite (printf ` cite="%s"` .Attributes.cite) "") .Text $citeLink $captionHTML -}}
{{- end -}}

{{ partial "layouts/box.html" (dict "content" $blockquoteContent "width" $width "align" $align) }}