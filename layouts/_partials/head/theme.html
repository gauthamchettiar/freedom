{{- /*
  Theme Variables Generator
  
  Generates inline CSS with theme variable overrides from hugo.yaml configuration.
  Falls back to theme.css defaults for any unconfigured variables.
  
  Configuration in hugo.yaml:
    params:
      theme:
        # Light theme
        bgColor: "#ffffff"
        textColor: "#222222"
        accentColor: "#007acc"
        linkColor: "#0000ee"
        linkVisited: "#551a8b"
        # Fonts
        bodyFont: "'Inter', 'Segoe UI', Arial, sans-serif"
        headerFont: "'Montserrat', 'Segoe UI', Arial, sans-serif"
        codeFont: "monospace"
        # Dark theme
        darkBgColor: "#212121"
        darkTextColor: "#F0F0F0"
        darkAccentColor: "#2b89c8"
        darkLinkColor: "#6b9eff"
        darkLinkVisited: "#b392ff"
        # Spacing
        spacingXxs: "0.125rem"
        spacingXs: "0.25rem"
        spacingSm: "0.5rem"
        spacingMd: "1rem"
        spacingLg: "1.5rem"
        spacingXl: "2rem"
        spacingXxl: "2.5rem"
        # Layout
        pageWidth: "768px"
        # Background image (light mode)
        bgImage: "path/to/image.jpg"
        bgImageSize: "cover"
        bgImagePosition: "center"
        bgImageAttachment: "fixed"
        bgImageRepeat: "no-repeat"
        bgOverlayOpacity: "0.65"
        # Background image (dark mode)
        darkBgImage: "path/to/dark-image.jpg"
        darkBgImageSize: "cover"
        darkBgImagePosition: "center"
        darkBgImageAttachment: "fixed"
        darkBgImageRepeat: "no-repeat"
        darkBgOverlayOpacity: "0.65"
  
  Context:
    Standard page context (.)
  
  Example:
    {{ partial "head/theme-vars.html" . }}
*/ -}}

{{- $page := . -}}
{{- $site := .Site -}}

{{- /* Build map of theme variables to check */ -}}
{{- $themeVars := dict
  "bgColor" "--bg-color"
  "textColor" "--text-color"
  "accentColor" "--accent-color"
  "linkColor" "--link-color"
  "linkVisited" "--link-visited"
  "bodyFont" "--body-font"
  "headerFont" "--header-font"
  "codeFont" "--code-font"
  "darkBgColor" "--dark-bg-color"
  "darkTextColor" "--dark-text-color"
  "darkAccentColor" "--dark-accent-color"
  "darkLinkColor" "--dark-link-color"
  "darkLinkVisited" "--dark-link-visited"
  "spacingXxs" "--spacing-xxs"
  "spacingXs" "--spacing-xs"
  "spacingSm" "--spacing-sm"
  "spacingMd" "--spacing-md"
  "spacingLg" "--spacing-lg"
  "spacingXl" "--spacing-xl"
  "spacingXxl" "--spacing-xxl"
  "pageWidth" "--page-width"
  "bgImage" "--bg-image"
  "bgImageSize" "--bg-image-size"
  "bgImagePosition" "--bg-image-position"
  "bgImageAttachment" "--bg-image-attachment"
  "bgImageRepeat" "--bg-image-repeat"
  "bgOverlayOpacity" "--bg-overlay-opacity"
  "darkBgImage" "--dark-bg-image"
  "darkBgImageSize" "--dark-bg-image-size"
  "darkBgImagePosition" "--dark-bg-image-position"
  "darkBgImageAttachment" "--dark-bg-image-attachment"
  "darkBgImageRepeat" "--dark-bg-image-repeat"
  "darkBgOverlayOpacity" "--dark-bg-overlay-opacity"
-}}

{{- /* Collect configured theme variables using config.html for hierarchical resolution */ -}}
{{- $configuredVars := slice -}}
{{- $themeConfig := partial "utils/config.html" (dict "key" "theme") -}}

{{- range $configKey, $cssVar := $themeVars -}}
  {{- $value := "" -}}
  
  {{- if $themeConfig -}}
    {{- $value = index $themeConfig $configKey -}}
  {{- end -}}
  
  {{- /* Special handling for background images - resolve resource */ -}}
  {{- if or (eq $configKey "bgImage") (eq $configKey "darkBgImage") -}}
    {{- if $value -}}
      {{ $value = partial "utils/resolve-image.html" $value }}
      {{- if $value -}}
        {{- $value = printf "url('%s')" $value -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}

  {{- if $value -}}
    {{- $configuredVars = $configuredVars | append (dict "var" $cssVar "value" $value) -}}
  {{- end -}}
{{- end -}}

{{- /* Generate CSS content as string */ -}}
{{- $cssContent := ":root {\n" -}}
{{- range $configuredVars -}}
  {{- $cssContent = printf "%s  %s: %s;\n" $cssContent .var .value -}}
{{- end -}}
{{- $cssContent = printf "%s}" $cssContent -}}

{{- /* Return the CSS content as a resource */ -}}
{{- return (resources.FromString "css/theme-overrides.css" $cssContent) -}}