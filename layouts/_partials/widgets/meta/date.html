{{- /*
  Time Display Widget
  
  Parameters:
    - page (required): Page context
    - site (required): Site context
    - dateType (optional): Which date to display - "date", "publishdate", "lastmod", "expirydate" (default: "date")
    - format (optional): Human-readable format (default: ":date_long")
      Options: ":date_long", ":date_medium", ":date_short", ":date_full"
      Or custom format like "January 2, 2006"
    - class (optional): Additional CSS classes
    - key (optional): Config key for visibility (default: "showDate")
  
  Example:
    {{ partial "widgets/meta/date.html" (dict "page" . "site" .Site "dateType" "lastmod" "format" ":date_medium") }}
    {{ partial "widgets/meta/date.html" (dict "page" . "site" .Site "format" "January 2, 2006") }}
*/ -}}

{{- $key := .key | default "Date" -}}
{{- $class := .class | default "" -}}

{{- $showDate := (partial "utils/config.html" (dict "key" (print "show" $key) "default" true)) -}}
{{- $showDateIcon := (partial "utils/config.html" (dict "key" (print "show" $key "Icon") "default" true)) -}}
{{- $dateType := (partial "utils/config.html" (dict "key" (print $key "Type") "default" (.dateType | default "date"))) -}}
{{- $dateFormat := (partial "utils/config.html" (dict "key" (print $key "Format") "default" (.dateFormat | default ":date_long"))) -}}

{{- $date := "" -}}
{{- if eq $dateType "publishdate" -}}
  {{- $date = page.PublishDate -}}
{{- else if eq $dateType "lastmod" -}}
  {{- $date = page.Lastmod -}}
{{- else if eq $dateType "expirydate" -}}
  {{- $date = page.ExpiryDate -}}
{{- else -}}
  {{- $date = page.Date -}}
{{- end -}}

{{- if and $date $showDate -}}
  {{- if $showDateIcon -}}
    {{ partialCached "widgets/icon.html" (dict "name" "calendar" "style" "regular") "calendar" "regular" }}
  {{- end -}}
  {{- $dateMachine := $date | time.Format "2006-01-02T15:04:05-07:00" -}}
  {{- $dateHuman := $date | time.Format $dateFormat -}}
  <time datetime="{{ $dateMachine }}" class="time {{ $class }}">{{ $dateHuman }}</time>
{{- end -}}
