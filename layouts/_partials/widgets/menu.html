{{ /*
Renders a menu for the given menu ID.

@context {page} page The current page.
@context {string} menuID The menu ID.
@context {string} withParentId Optional. If provided, only renders children of the specified parent menu item.

@example: {{ partial "menu.html" (dict "menuID" "main" "page" .) }}
@example: {{ partial "menu.html" (dict "menuID" "main" "page" . "withParentId" "Documentation") }}
*/}}

{{ $page := .page }}
{{ $site := .site }}
{{ $menuID := .menuID }}
{{ $withParentId := .withParentId | default "" }}
{{ $key := .key | default "showMenu" }}
{{ $class := .class | default "" }}

{{ $showMenu := (partial "config.html" (dict "page" $page "site" $site "key" $key)) }}

{{- if not $showMenu -}}
  {{- return -}}
{{- end -}}

{{- with index site.Menus $menuID }}
  <nav role="navigation" aria-label="{{ $menuID }} navigation">
    <ul class="menu-{{ $menuID }} {{ $class }}">
      {{- if $withParentId }}
        {{- partial "inline/menu/walk-children.html" (dict "page" $page "menuEntries" . "parentId" $withParentId) }}
      {{- else }}
        {{- partial "inline/menu/walk.html" (dict "page" $page "menuEntries" .) }}
      {{- end }}
    </ul>
  </nav>
{{- end }}

{{- define "_partials/inline/menu/walk.html" }}
  {{- $page := .page }}
  {{- range .menuEntries }}
    {{- $attrs := dict "href" .URL }}
    {{- if $page.IsMenuCurrent .Menu . }}
      {{- $attrs = merge $attrs (dict "class" "active" "aria-current" "page") }}
    {{- else if $page.HasMenuCurrent .Menu .}}
      {{- $attrs = merge $attrs (dict "class" "ancestor" "aria-current" "true") }}
    {{- end }}
    {{- $name := .Name }}
    {{- with .Identifier }}
      {{- with T . }}
        {{- $name = . }}
      {{- end }}
    {{- end }}
    <li>
      <a
        {{- range $k, $v := $attrs }}
          {{- with $v }}
            {{- printf " %s=%q" $k $v | safeHTMLAttr }}
          {{- end }}
        {{- end -}}
      >{{ $name }}</a>
    </li>
  {{- end }}
{{- end }}

{{- define "_partials/inline/menu/walk-children.html" }}
  {{- $page := .page }}
  {{- $parentId := .parentId }}
  {{- range .menuEntries }}
    {{- if eq .Name $parentId }}
      {{- range .Children }}
        {{- $childAttrs := dict "href" .URL }}
        {{- if $page.IsMenuCurrent .Menu . }}
          {{- $childAttrs = merge $childAttrs (dict "class" "active" "aria-current" "page") }}
        {{- else if $page.HasMenuCurrent .Menu .}}
          {{- $childAttrs = merge $childAttrs (dict "class" "ancestor" "aria-current" "true") }}
        {{- end }}
        {{- $childName := .Name }}
        {{- with .Identifier }}
          {{- with T . }}
            {{- $childName = . }}
          {{- end }}
        {{- end }}
        <li>
          <a
            {{- range $k, $v := $childAttrs }}
              {{- with $v }}
                {{- printf " %s=%q" $k $v | safeHTMLAttr }}
              {{- end }}
            {{- end -}}
          >{{ $childName }}</a>
        </li>
      {{- end }}
    {{- end }}
  {{- end }}
{{- end }}
