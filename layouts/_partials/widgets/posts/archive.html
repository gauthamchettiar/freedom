{{/*
  Archive Widget - Year-grouped post listing
  
  Auto-detects scope: section archive vs site-wide archive based on parent page.
  
  Parameters:
    - class (string): Additional CSS class
    - listType (string): "simple" or "card" (default: "simple")
    - showHidden (bool): Include hidden posts (default: false)
    - scope (string): Override auto-detection - "site" or "section"
  
  Usage:
    {{ partial "widgets/posts/archive.html" }}
    {{ partial "widgets/posts/archive.html" (dict "scope" "site") }}
*/}}

{{ $class      := .class }}
{{ $scope      := .scope }}
{{ $listType   := .listType | default "simple" }}
{{ $showHidden := .showHidden | default false }}

{{/* Auto-detect scope: if parent is a section, use section pages; otherwise site-wide */}}
{{ if not $scope }}
    {{ if and page.Parent (ne page.Parent.Kind "home") }}
        {{ $scope = "section" }}
    {{ else }}
        {{ $scope = "site" }}
    {{ end }}
{{ end }}

{{/* Fetch pages based on scope */}}
{{ $pages := site.RegularPages }}
{{ if eq $scope "section" }}
    {{ $pages = page.Parent.RegularPages }}
{{ end }}

{{ with $pages }}
<section class="fr-posts-container archive {{ $class }}">
    {{- range ($pages.GroupByDate "2006") -}}
        {{- $yearPages := .Pages -}}
        {{ if gt (len $yearPages) 0 }}
            <h4 class="archive-year">{{ .Key }}</h4>
            {{ partial "widgets/posts/base.html" (dict 
                "pages" $yearPages 
                "listType" $listType 
                "paginate" false 
                "limit" -1
                "showHidden" $showHidden
            ) }}
        {{ end }}
    {{ end }}
</section>
{{ else }}
    <p>{{ i18n "no_posts_found" }}</p>
{{ end }}